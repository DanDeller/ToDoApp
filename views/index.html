<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>seoTestApp</title>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
  <style type="text/css">
    body {margin: 0; padding: 0; border: none}
    h1 {margin: 50px 0 20px 0}
    ul {list-style: none; margin: 0 0 20px -40px}
    .list {margin: 20px 0 0 0}
    .list p {float:left; margin: 0 20px 0 0; font-size: 16px}
    .single-todo {width: 300px; height: 30px; margin: 0 0 10px 0; border-bottom: 1px solid #ccc; padding: 0 0px 35px 0; cursor: pointer;}
    .destroy, .update {float: right}
  </style>
</head>
<body>
  <div class="container">
		<h1>Todo List</h1>

    <!-- post new todos -->
    <h3>Add tasks</h3>
	<form action='/tasks' method='post'>
		<input class="name" name="name" type="text" placeholder='name' />
		<input class="task" name="task" type="text" placeholder='task' />
		<input type="submit">
	</form>

    <!-- loop -->
    <div class="list">
      <ul class="task-list"></ul>
    </div>

    <!-- way to update todo -->
    <h3>Update tasks</h3>
    <form class="form2" action="/tasks" method="PUT">
      <input type="hidden" name="id" value="">
      <input type="text" name="name" value="" placeholder='name'>
      <input type="text" name="task" value="" placeholder='task'>
      <input type="submit">
    </form>

  </div>
<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {

    var output = '',
         form    = $('.form2'),
         tasks;

    // display all tasks
    function displayTasks(tasks) {
        var taskList = $('.task-list');
        $.each(tasks, function(i) {
            taskList.append(
                  '<li class="single-todo">' +
                      '<p class="name">' + tasks[i].name + ' - ' + tasks[i].task + '</p>' +
                      '<button data-id="' + tasks[i].id + '" class="destroy">Delete</button>' +
                  '</li>'
              );
        });
    }

    // get all tasks
    function getTasks(ajaxData) {
        $.ajax({
            url: 'http://localhost:3000/tasks',
            dataType: 'json',
            success: function(data) {
                  tasks = data;
                  ajaxData(data);
            }
        }).done(function() {
            displayTasks(tasks);
        });
    }

    // use ajax data outside of getTask(ajaxData)
    getTasks(function(output) {
        console.log(output)
    });

    // get id
    $(document).on('click','.single-todo',function() {
        var todo = $(this),
             id = todo.find('button').attr('data-id');
        form.find('[type="hidden"]').val(id);
    });

    // delete tasks
    $(document).on('click', '.destroy[data-id]', function() {
      var self = $(this),
           id   = self.attr('data-id');
        $(this).parent().fadeOut(500, function() {
            $.ajax({
                url: 'http://localhost:3000/tasks/?id=' + id,
                type: 'DELETE',
                success: function(data) {
                      console.log('task deleted');
                }
            });
        });
    });

    // update tasks
    $('.form2').on('submit', function(e) {
        e.preventDefault();
        var data = {};
        data.id = $('.form2 [name="id"]').val();
        data.name = $('.form2 [name="name"]').val();
        data.task = $('.form2 [name="task"]').val();
        $.ajax({
            url: 'http://localhost:3000/tasks',
            type: 'PATCH',
            data: data,
            success: function(data) {
                location.reload(true);
                console.log('task updated');
            }
        });
    });

});
</script>
</body>
</html>